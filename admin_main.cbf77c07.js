var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},a={},n=e.parcelRequire0562;null==n&&((n=function(e){if(e in t)return t[e].exports;if(e in a){var n=a[e];delete a[e];var o={id:e,exports:{}};return t[e]=o,n.call(o.exports,o,o.exports),o.exports}var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){a[e]=t},e.parcelRequire0562=n);var o=n("2shzp");const r=document.querySelector("#logoutButton"),s=document.querySelector(".spinner-border"),c=o.default.create({baseURL:"https://flexyplanner.onrender.com/auth/logout",headers:{Authorization:`Bearer ${window.sessionStorage.getItem("accessToken")}`}});r.addEventListener("click",(async()=>{s.style.display="inline-block";try{await c.post("",{}),window.location.href="/login.html",window.sessionStorage.removeItem("accessToken")}catch(e){401===e.response.status&&(window.location.href="/login.html",window.sessionStorage.removeItem("accessToken"))}finally{s.style.display="none"}}));const i=(o=n("2shzp")).default.create({baseURL:"https://flexyplanner.onrender.com",headers:{Authorization:`Bearer ${window.sessionStorage.getItem("accessToken")}`}}),l=async()=>{const{data:e}=await i.get("/promo/");return e},d=async e=>(await i.post("/promo",e)).data,u=async e=>(await i.patch("/promo",e)).data,p=async e=>(await i.delete("/promo",e)).data;var m=n("eWCmQ");const f=document.querySelector(".promocode__form"),y=document.querySelector(".input-amount-js"),g=document.querySelector(".date__wrapper"),v=document.querySelector(".common-promocode"),h=document.querySelector(".personal-promocode"),b=document.querySelector("#dateStart"),w=document.querySelector("#dateTo"),S={};function L(){const e=new Date;let t=e.getDate(),a=e.getMonth()+1;a<10&&(a="0"+a),t<10&&(t="0"+t);return e.getFullYear()+"-"+a+"-"+t}function $({common:e,personal:t}){const a=e.map((({discount:e,promo:t,period:a},n)=>`<li class="list__item" data-name='${t}'>\n            <p>Знижка ${e}%</p>\n            <p>Термін дії: ${a.from.slice(0,10)} - ${a.to.slice(0,10)}</p>\n            <div class="common__wrapper">\n            <p>${n+1}. <span class="promo__name">${t}</span></p>\n            <button data-action="delete" class="btn btn-danger" type="button">Видалити</button>\n            </div>\n            </li>`)).join(""),n=t.reduce(((e,t)=>(e[t.discount]=e[t.discount]||[],e[t.discount].push(t),e)),{}),o=Object.entries(n).map((e=>`\n        <p>Знижка ${e[0]}%</p>\n        <ul class="list__item">\n          ${e[1].map(((e,t)=>`\n                    <li class="personal__wrapper" data-name='${e.promo}'>\n                    <span>${t+1}. \n                      <span class="promo__name">${e.promo}</span>\n                    </span>\n                    <div class="btn-wrapper">\n                    ${e.isUsing?'<button data-action="active" disabled class="btn btn-success" type="button">Активовано</button>':'<button data-action="active" class="btn btn-success" type="button">Активувати</button>'}\n                    <button data-action="delete" class="btn btn-danger" type="button">Видалити</button></div>\n                    </li>`)).join("")}</ul>`)).join("");v.innerHTML=a,h.innerHTML=o}b.value=L(),w.value=L(),l().then((e=>$(e))).catch((e=>console.log(e.message))),setInterval((()=>{l().then((e=>$(e))).catch((e=>console.log(e.message)))}),36e5),f.addEventListener("change",(function(e){e.preventDefault(),"Personal"===e.currentTarget.elements.promocode.value?(y.disabled&&(y.disabled=!1),g.classList.add("visually-hidden")):(g.classList.contains("visually-hidden")&&g.classList.remove("visually-hidden"),y.disabled=!0)})),f.addEventListener("submit",(function(e){e.preventDefault();const t=e.currentTarget,{elements:{promocode:a,amount:n,discount:o,dateStart:r,dateTo:s}}=t;"Personal"===a.value?(S.type=a.value,S.amount=Number(n.value),S.discount=Number(o.value)):(S.type=a.value,S.discount=Number(o.value),S.amount=Number(n.value),S.from=new Date(r.value).toISOString(),S.to=new Date(s.value).toISOString()),console.log(S),d(S).then((e=>console.log(e))).catch((e=>{401===e.response.request.status&&(alert("Час сесії минув. Будь ласка, пройдіть повторну авторизацію!"),window.location.href="/login.html")})),y.disabled&&(y.disabled=!1),g.classList.contains("visually-hidden")&&g.classList.remove("visually-hidden"),t.reset(),b.value=L(),w.value=L()})),v.addEventListener("click",(function(e){if("BUTTON"!==e.target.nodeName)return;const t=e.target.closest("li"),a=t.dataset.name;confirm(`Дійсно видалити цей промокод: ${a} ?`)?p({data:{promocode:a}}).then((e=>{1==e.ok&&(m.Notify.failure(`${a} is delete now.`),t.remove())})).catch((e=>{401===e.response.request.status&&(alert("Час сесії минув. Будь ласка, пройдіть повторну авторизацію!"),window.location.href="/login.html")})):m.Notify.info(`do not delete ${a}`)})),h.addEventListener("click",(function(e){if("BUTTON"!==e.target.nodeName)return;const t=e.target.dataset.action,a=e.target.closest("li"),n=a.dataset.name;if("delete"===t){confirm(`Дійсно видалити цей промокод: ${n} ?`)?p({data:{promocode:n}}).then((e=>{1==e.ok&&(m.Notify.failure(`${n} is delete now.`),a.remove())})).catch((e=>{401===e.response.request.status&&(alert("Час сесії минув. Будь ласка, пройдіть повторну авторизацію!"),window.location.href="/login.html")})):m.Notify.info(`Do not delete ${n}`)}else{confirm(`Дійсно активувати цей промокод: ${n} ?`)?u({promocode:n}).then((t=>{"switchPromoStatus"===t&&(e.target.disabled=!0,e.target.innerText="Активовано",m.Notify.success(`${n} is active.`))})).catch((e=>{401===e.response.request.status&&(alert("Час сесії минув. Будь ласка, пройдіть повторну авторизацію!"),window.location.href="/login.html")})):m.Notify.info(`Do not active ${n}.`)}}));const q=(o=n("2shzp")).default.create({baseURL:"https://flexyplanner.onrender.com/markup"}),T=async()=>{const{data:e}=await q.get("");return e},N=async()=>{const{data:e}=await q.patch("");return e},_=async e=>{const{data:t}=await q.put("",e);return t},k=document.querySelector(".order-admin"),D=document.querySelector('[data-status="to-order"]'),x=document.querySelector('[data-status="pre-order"]'),O=document.querySelector(".form-to-order"),E=document.querySelector(".form-pre-order"),U=e=>{"pre-order"===e.type?document.querySelector(".preorder-price-info").innerHTML=`Встановлена ціна: ${e.data.price}, ціна зі знижкою:  ${e.data.preOrderPrice}`:document.querySelector(".price-info").innerHTML=`Встановлена ціна: ${e.data.price}`},I=async e=>{e.classList.remove("btn-danger"),e.classList.add("btn-success"),e.innerText="Активовано",e.disabled=!0;try{const e=await T();U(e)}catch(e){Notify.failure(e.message)}},j=async(e,t)=>{try{await N(),I(e),t.classList.remove("btn-success"),t.classList.add("btn-danger"),t.innerText="Активувати",t.disabled=!1}catch(e){Notify.failure(e.message)}};k.addEventListener("click",(e=>{e.target.classList.contains("btn-order-js")&&("pre-order"==e.target.dataset.status?j(e.target,D):j(e.target,x))})),O.addEventListener("submit",(async e=>{e.preventDefault();const t={type:"to-order",data:{price:e.target.elements.price.value}};try{const e=await _(t);U(e)}catch(e){Notify.failure(e.message)}})),E.addEventListener("submit",(async e=>{e.preventDefault();const t={type:"pre-order",data:{price:e.target.elements.price.value,preOrderPrice:e.target.elements.preOrderPrice.value}};try{const e=await _(t);U(e)}catch(e){Notify.failure(e.message)}})),async function(){try{"pre-order"===(await T()).type?I(x):I(D)}catch(e){Notify.failure(e.message)}}();
//# sourceMappingURL=admin_main.cbf77c07.js.map
