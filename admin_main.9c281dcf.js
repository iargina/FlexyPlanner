var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},n={},a=e.parcelRequire0562;null==a&&((a=function(e){if(e in t)return t[e].exports;if(e in n){var a=n[e];delete n[e];var o={id:e,exports:{}};return t[e]=o,a.call(o.exports,o,o.exports),o.exports}var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){n[e]=t},e.parcelRequire0562=a);var o=a("2shzp");const s=document.querySelector("#logoutButton"),r=document.querySelector(".spinner-border"),i=o.default.create({baseURL:"https://api.flexyplanner.com/auth/logout",headers:{Authorization:`Bearer ${window.sessionStorage.getItem("accessToken")}`}});s.addEventListener("click",(async()=>{r.style.display="inline-block";try{await i.post("",{}),window.location.href="/login.html",window.sessionStorage.removeItem("accessToken")}catch(e){401===e.response.status&&(window.location.href="/login.html",window.sessionStorage.removeItem("accessToken"))}finally{r.style.display="none"}}));const l=(o=a("2shzp")).default.create({baseURL:"https://api.flexyplanner.com",headers:{Authorization:`Bearer ${window.sessionStorage.getItem("accessToken")}`}}),c=async()=>{const{data:e}=await l.get("/promo/");return e},d=async e=>(await l.post("/promo",e)).data,u=async e=>(await l.patch("/promo",e)).data,p=async e=>(await l.delete("/promo",e)).data;var m=a("eWCmQ");const y=document.querySelector(".promocode__form"),f=document.querySelector(".input-amount-js"),v=document.querySelector(".date__wrapper"),b=document.querySelector(".common-promocode"),g=document.querySelector(".personal-promocode"),h=document.querySelector("#dateStart"),w=document.querySelector("#dateTo"),L=document.querySelector(".promo-spinner-js"),S=document.querySelector(".btn-show-common-js"),$=document.querySelector(".btn-show-personal-js"),k={};function N(){const e=new Date;let t=e.getDate(),n=e.getMonth()+1;n<10&&(n="0"+n),t<10&&(t="0"+t);return e.getFullYear()+"-"+n+"-"+t}function T({common:e,personal:t}){const n=e.map((({discount:e,promo:t,period:n},a)=>`<li class="list__item" data-name='${t}'>\n            <p>Знижка ${e}%</p>\n            <p>Термін дії: ${n.from.slice(0,10).split("-").reverse().join("-")} - ${n.to.slice(0,10).split("-").reverse().join("-")}</p>\n            <div class="common__wrapper">\n            <p>${a+1}. <span class="promo__name">${t}</span></p>\n            <button data-action="delete" class="btn btn-danger" type="button">Видалити</button>\n            </div>\n            </li>`)).join(""),a=t.reduce(((e,t)=>(e[t.discount]=e[t.discount]||[],e[t.discount].push(t),e)),{}),o=Object.entries(a).map((e=>`\n        <p>Знижка ${e[0]}%</p>\n        <ul class="list__item">\n          ${e[1].map(((e,t)=>`\n                    <li class="personal__wrapper" data-name='${e.promo}'>\n                    <span>${t+1}. \n                      <span class="promo__name">${e.promo}</span>\n                    </span>\n                    <div class="btn-wrapper">\n                    ${e.isUsing?'<button data-action="active" disabled class="btn btn-success" type="button">Активовано</button>':'<button data-action="active" class="btn btn-success" type="button">Активувати</button>'}\n                    <button data-action="delete" class="btn btn-danger" type="button">Видалити</button></div>\n                    </li>`)).join("")}</ul>`)).join("");b.innerHTML=n,g.innerHTML=o}function q(e){401===e.response.request.status&&(alert("Час сесії минув. Будь ласка, пройдіть повторну авторизацію!"),window.location.href="/login.html")}h.value=N(),w.value=N(),setInterval((()=>{c().then((e=>T(e))).catch((e=>console.log(e.message)))}),36e5),L.style.display="inline-block",c().then((e=>T(e))).catch((e=>console.log(e.message))).finally((()=>L.style.display="none")),y.addEventListener("change",(function(e){e.preventDefault(),"Personal"===e.currentTarget.elements.promocode.value?(f.disabled&&(f.disabled=!1),v.classList.add("visually-hidden")):(v.classList.contains("visually-hidden")&&v.classList.remove("visually-hidden"),f.disabled=!0)})),y.addEventListener("submit",(async function(e){L.style.display="inline-block";try{e.preventDefault();const t=e.currentTarget,{elements:{promocode:n,amount:a,discount:o,dateStart:s,dateTo:r}}=t;"Personal"===n.value?(k.type=n.value,k.amount=Number(a.value),k.discount=Number(o.value)):(k.type=n.value,k.discount=Number(o.value),k.amount=Number(a.value),k.from=new Date(s.value).toISOString(),k.to=new Date(r.value).toISOString());if((await d(k)).length){T(await c()),m.Notify.success("Список промокодів успішно оновлено!")}f.disabled&&(f.disabled=!1),v.classList.contains("visually-hidden")&&v.classList.remove("visually-hidden"),t.reset(),h.value=N(),w.value=N()}catch(e){q(e)}finally{L.style.display="none"}})),b.addEventListener("click",(function(e){if("BUTTON"!==e.target.nodeName)return;const t=e.target.closest("li"),n=t.dataset.name;confirm(`Дійсно видалити цей промокод: ${n} ?`)?(L.style.display="inline-block",p({data:{promocode:n}}).then((e=>{1==e.ok&&(m.Notify.failure(`${n} успішно видалено!`),t.remove())})).catch((e=>q(e))).finally((()=>L.style.display="none"))):m.Notify.info(`Видалення ${n} відмінено`)})),g.addEventListener("click",(function(e){if("BUTTON"!==e.target.nodeName)return;const t=e.target.dataset.action,n=e.target.closest("li"),a=n.dataset.name;if("delete"===t){confirm(`Дійсно видалити цей промокод: ${a} ?`)?(L.style.display="inline-block",p({data:{promocode:a}}).then((e=>{1==e.ok&&(m.Notify.failure(`${a} успішно видалено!`),n.remove())})).catch((e=>q(e))).finally((()=>L.style.display="none"))):m.Notify.info(`Видалення ${a} відмінено.`)}else{confirm(`Дійсно активувати цей промокод: ${a} ?`)?(L.style.display="inline-block",u({promocode:a}).then((t=>{"switchPromoStatus"===t&&(e.target.disabled=!0,e.target.innerText="Активовано",m.Notify.success(`${a} успішно активовано.`))})).catch((e=>q(e))).finally((()=>L.style.display="none"))):m.Notify.info(`Активацію ${a} відмінено.`)}})),S.addEventListener("click",(function(){b.classList.toggle("visually-hidden"),S.textContent="Сховати",b.classList.contains("visually-hidden")&&(S.textContent="Показати")})),$.addEventListener("click",(function(){g.classList.toggle("visually-hidden"),$.textContent="Сховати",g.classList.contains("visually-hidden")&&($.textContent="Показати")}));m=a("eWCmQ");const _=(o=a("2shzp")).default.create({baseURL:"https://api.flexyplanner.com"}),x=async()=>{const{data:e}=await _.get("/markup");return e},j=async()=>{const{data:e}=await _.patch("/markup");return e},E=async e=>{const{data:t}=await _.put("/markup",e);return t},D=document.querySelector(".order-admin"),O=document.querySelector('[data-status="to-order"]'),U=document.querySelector('[data-status="pre-order"]'),C=document.querySelector(".form-pre-order"),I=async e=>{e.classList.remove("btn-danger"),e.classList.add("btn-success"),e.innerText="Активовано",e.disabled=!0},z=async(e,t)=>{try{await j(),I(e),t.classList.remove("btn-success"),t.classList.add("btn-danger"),t.innerText="Активувати",t.disabled=!1}catch(e){m.Notify.failure(e.message)}};D.addEventListener("click",(e=>{e.target.classList.contains("btn-order-js")&&("pre-order"==e.target.dataset.status?z(e.target,O):z(e.target,U))})),C.addEventListener("submit",(async e=>{e.preventDefault();const t={type:"pre-order",data:{price:e.target.elements.price.value}};try{await E(t),m.Notify.success("Декоративна ціна для модуля попереднього замовлення встановлена")}catch(e){m.Notify.failure("Не вдалось встановити декоративну ціну для модуля попереднього замовлення. Спробуйте пізніше")}finally{C.reset()}})),async function(){try{"pre-order"===(await x()).type?I(U):I(O)}catch(e){m.Notify.failure(e.message)}}();
//# sourceMappingURL=admin_main.9c281dcf.js.map
