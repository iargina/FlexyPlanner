!function(){function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},r={},a=t.parcelRequire0562;null==a&&((a=function(e){if(e in n)return n[e].exports;if(e in r){var t=r[e];delete r[e];var a={id:e,exports:{}};return n[e]=a,t.call(a.exports,a,a.exports),a.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){r[e]=t},t.parcelRequire0562=a);var o,c=a("bpxeT"),s=a("2TvXO"),u=a("dIxxU"),i=document.querySelector("#logoutButton"),l=document.querySelector(".spinner-border"),p=u.default.create({baseURL:"https://api.flexyplanner.com/auth/logout",headers:{Authorization:"Bearer ".concat(window.sessionStorage.getItem("accessToken"))}}),d=(o=e(c)(e(s).mark((function t(){return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l.style.display="inline-block",e.prev=1,e.next=4,p.post("",{});case 4:window.location.href="/login.html",window.sessionStorage.removeItem("accessToken"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),401===e.t0.response.status&&(window.location.href="/login.html",window.sessionStorage.removeItem("accessToken"));case 11:return e.prev=11,l.style.display="none",e.finish(11);case 14:case"end":return e.stop()}}),t,null,[[1,8,11,14]])}))),function(){return o.apply(this,arguments)});i.addEventListener("click",d);c=a("bpxeT"),s=a("2TvXO"),c=a("bpxeT"),s=a("2TvXO");var f=(u=a("dIxxU")).default.create({baseURL:"https://api.flexyplanner.com",headers:{Authorization:"Bearer ".concat(window.sessionStorage.getItem("accessToken"))}}),m=function(){var t=e(c)(e(s).mark((function t(){var n;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.get("/promo/");case 2:return n=e.sent.data,e.abrupt("return",n);case 4:case"end":return e.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),v=function(){var t=e(c)(e(s).mark((function t(n){var r;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.post("/promo",n);case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),y=function(){var t=e(c)(e(s).mark((function t(n){var r;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.patch("/promo",n);case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),h=function(){var t=e(c)(e(s).mark((function t(n){var r;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.delete("/promo",n);case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),b=a("iU1Pc"),x=document.querySelector(".promocode__form"),w=document.querySelector(".input-amount-js"),g=document.querySelector(".date__wrapper"),k=document.querySelector(".common-promocode"),T=document.querySelector(".personal-promocode"),L=document.querySelector("#dateStart"),S=document.querySelector("#dateTo"),N=document.querySelector(".promo-spinner-js"),_=document.querySelector(".btn-show-common-js"),q=document.querySelector(".btn-show-personal-js"),O={};function U(){var e=new Date,t=e.getDate(),n=e.getMonth()+1;return n<10&&(n="0"+n),t<10&&(t="0"+t),e.getFullYear()+"-"+n+"-"+t}function j(){return(j=e(c)(e(s).mark((function t(n){var r,a,o,c,u,i,l,p;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N.style.display="inline-block",e.prev=1,n.preventDefault(),r=n.currentTarget,a=r.elements,o=a.promocode,c=a.amount,u=a.discount,i=a.dateStart,l=a.dateTo,"Personal"===o.value?(O.type=o.value,O.amount=Number(c.value),O.discount=Number(u.value)):((p=new Date(l.value)).setHours(23,59,59),O.type=o.value,O.discount=Number(u.value),O.amount=Number(c.value),O.from=new Date(i.value).toISOString(),O.to=p.toISOString()),e.next=8,v(O);case 8:if(!e.sent.length){e.next=15;break}return e.next=12,m();case 12:E(e.sent),b.Notify.success("Список промокодів успішно оновлено!");case 15:w.disabled&&(w.disabled=!1),g.classList.contains("visually-hidden")&&g.classList.remove("visually-hidden"),r.reset(),L.value=U(),S.value=U(),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(1),I(e.t0);case 25:return e.prev=25,N.style.display="none",e.finish(25);case 28:case"end":return e.stop()}}),t,null,[[1,22,25,28]])})))).apply(this,arguments)}function E(e){var t=e.common,n=e.personal,r=t.map((function(e,t){var n=e.discount,r=e.promo,a=e.period;return'<li class="list__item" data-name=\''.concat(r,"'>\n            <p>Знижка ").concat(n,"%</p>\n            <p>Термін дії: ").concat(a.from.slice(0,10).split("-").reverse().join("-")," - ").concat(a.to.slice(0,10).split("-").reverse().join("-"),'</p>\n            <div class="common__wrapper">\n            <p>').concat(t+1,'. <span class="promo__name">').concat(r,'</span></p>\n            <button data-action="delete" class="btn btn-danger" type="button">Видалити</button>\n            </div>\n            </li>')})).join(""),a=n.reduce((function(e,t){return e[t.discount]=e[t.discount]||[],e[t.discount].push(t),e}),{}),o=Object.entries(a).map((function(e){return"\n        <p>Знижка ".concat(e[0],'%</p>\n        <ul class="list__item">\n          ').concat(e[1].map((function(e,t){return'\n                    <li class="personal__wrapper" data-name=\''.concat(e.promo,"'>\n                    <span>").concat(t+1,'. \n                      <span class="promo__name">').concat(e.promo,'</span>\n                    </span>\n                    <div class="btn-wrapper">\n                    ').concat(e.isUsing?'<button data-action="active" disabled class="btn btn-success" type="button">Активовано</button>':'<button data-action="active" class="btn btn-success" type="button">Активувати</button>','\n                    <button data-action="delete" class="btn btn-danger" type="button">Видалити</button></div>\n                    </li>')})).join(""),"</ul>")})).join("");k.innerHTML=r,T.innerHTML=o}function I(e){401===e.response.request.status&&(alert("Час сесії минув. Будь ласка, пройдіть повторну авторизацію!"),window.location.href="/login.html")}L.value=U(),S.value=U(),setInterval((function(){m().then((function(e){return E(e)})).catch((function(e){return console.log(e.message)}))}),36e5),N.style.display="inline-block",m().then((function(e){return E(e)})).catch((function(e){return console.log(e.message)})).finally((function(){return N.style.display="none"})),x.addEventListener("change",(function(e){e.preventDefault(),"Personal"===e.currentTarget.elements.promocode.value?(w.disabled&&(w.disabled=!1),g.classList.add("visually-hidden")):(g.classList.contains("visually-hidden")&&g.classList.remove("visually-hidden"),w.disabled=!0)})),x.addEventListener("submit",(function(e){return j.apply(this,arguments)})),k.addEventListener("click",(function(e){if("BUTTON"===e.target.nodeName){var t=e.target.closest("li"),n=t.dataset.name;confirm("Дійсно видалити цей промокод: ".concat(n," ?"))?(N.style.display="inline-block",h({data:{promocode:n}}).then((function(e){1==e.ok&&(b.Notify.failure("".concat(n," успішно видалено!")),t.remove())})).catch((function(e){return I(e)})).finally((function(){return N.style.display="none"}))):b.Notify.info("Видалення ".concat(n," відмінено"))}})),T.addEventListener("click",(function(e){if("BUTTON"===e.target.nodeName){var t=e.target.dataset.action,n=e.target.closest("li"),r=n.dataset.name;if("delete"===t)confirm("Дійсно видалити цей промокод: ".concat(r," ?"))?(N.style.display="inline-block",h({data:{promocode:r}}).then((function(e){1==e.ok&&(b.Notify.failure("".concat(r," успішно видалено!")),n.remove())})).catch((function(e){return I(e)})).finally((function(){return N.style.display="none"}))):b.Notify.info("Видалення ".concat(r," відмінено."));else confirm("Дійсно активувати цей промокод: ".concat(r," ?"))?(N.style.display="inline-block",y({promocode:r}).then((function(t){"switchPromoStatus"===t&&(e.target.disabled=!0,e.target.innerText="Активовано",b.Notify.success("".concat(r," успішно активовано.")))})).catch((function(e){return I(e)})).finally((function(){return N.style.display="none"}))):b.Notify.info("Активацію ".concat(r," відмінено."))}})),_.addEventListener("click",(function(){k.classList.toggle("visually-hidden"),_.textContent="Сховати",k.classList.contains("visually-hidden")&&(_.textContent="Показати")})),q.addEventListener("click",(function(){T.classList.toggle("visually-hidden"),q.textContent="Сховати",T.classList.contains("visually-hidden")&&(q.textContent="Показати")}));c=a("bpxeT"),s=a("2TvXO"),b=a("iU1Pc"),c=a("bpxeT"),s=a("2TvXO");var D=(u=a("dIxxU")).default.create({baseURL:"https://api.flexyplanner.com"}),B=function(){var t=e(c)(e(s).mark((function t(){var n;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.get("/markup");case 2:return n=e.sent.data,e.abrupt("return",n);case 4:case"end":return e.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),C=function(){var t=e(c)(e(s).mark((function t(){var n;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.patch("/markup");case 2:return n=e.sent.data,e.abrupt("return",n);case 4:case"end":return e.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),M=function(){var t=e(c)(e(s).mark((function t(n){var r;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.put("/markup",n);case 2:return r=e.sent.data,e.abrupt("return",r);case 4:case"end":return e.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),P=(function(){var t=e(c)(e(s).mark((function t(){var n;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.get("/crm/offers");case 2:return n=e.sent.data,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),t)})))}(),document.querySelector(".order-admin")),R=document.querySelector('[data-status="to-order"]'),X=document.querySelector('[data-status="pre-order"]'),H=document.querySelector(".form-pre-order"),z=function(){var t=e(c)(e(s).mark((function t(n){return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.classList.remove("btn-danger"),n.classList.add("btn-success"),n.innerText="Активовано",n.disabled=!0;case 4:case"end":return e.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),A=function(){var t=e(c)(e(s).mark((function t(n,r){return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,C();case 3:z(n),r.classList.remove("btn-success"),r.classList.add("btn-danger"),r.innerText="Активувати",r.disabled=!1,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),b.Notify.failure(e.t0.message);case 13:case"end":return e.stop()}}),t,null,[[0,10]])})));return function(e,n){return t.apply(this,arguments)}}(),F=function(){var t=e(c)(e(s).mark((function t(n){var r;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),r={type:"pre-order",data:{price:n.target.elements.price.value}},e.prev=2,e.next=5,M(r);case 5:b.Notify.success("Декоративна ціна для модуля попереднього замовлення встановлена"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),b.Notify.failure("Не вдалось встановити декоративну ціну для модуля попереднього замовлення. Спробуйте пізніше");case 11:return e.prev=11,H.reset(),e.finish(11);case 14:case"end":return e.stop()}}),t,null,[[2,8,11,14]])})));return function(e){return t.apply(this,arguments)}}();function Y(){return(Y=e(c)(e(s).mark((function t(){return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,B();case 3:"pre-order"===e.sent.type?z(X):z(R),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),b.Notify.failure(e.t0.message);case 10:case"end":return e.stop()}}),t,null,[[0,7]])})))).apply(this,arguments)}P.addEventListener("click",(function(e){e.target.classList.contains("btn-order-js")&&("pre-order"==e.target.dataset.status?A(e.target,R):A(e.target,X))})),H.addEventListener("submit",F),function(){Y.apply(this,arguments)}()}();
//# sourceMappingURL=admin_main.47740bdf.js.map
